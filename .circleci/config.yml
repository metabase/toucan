version: 2.1

executors:
  toucan-executor:
    #  todo fix machine so boots db and tests run
    machine: true
    environment:
      TZ: America/Los_Angeles
      TOUCAN_TEST_DB_NAME: circle_test
      TOUCAN_TEST_DB_USER: ubuntu

jobs:
  test:
    executor: toucan-executor
    steps:
      - checkout
      - run: './start-db'
      - run: 'lein test && lein lint'

  snapshot:
    executor: toucan-executor
    steps:
      - checkout
      - run:
          command: |
            echo "$(cat project/VERSION)-$CIRCLE_BRANCH-SNAPSHOT" > project/VERSION
    # set version to version-branch-snapshot

#  deploy:
#    # deploy


workflows:
  version: 2
  test_snapshot_deploy:
    jobs:
      - test
      - snapshot:
          requires:
            - test
